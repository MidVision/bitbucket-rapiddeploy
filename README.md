# RapidDeploy integration for Bitbucket Pipelines

### Bitbucket Pipelines

Bitbucket Pipelines is a new continuous delivery feature built within Bitbucket Cloud. RapidDeploy integration with Bitbucket is very simple. It allows you to build package, deploy or run RapidDeploy job directly from Bitbucket. You can configure your Bitbucket Pipeline to perform actions from RapidDeploy automatically every time your code is pushed to the branch.


There are three actions that you can use in your Bitbucket Pipeline
* [RapidDeploy build package task](http://docs.midvision.com/LATEST/project/package.html) invoke RapidDeploy server to build a package in the configured artifact repository. You can check the result and the log output in the Pipelines logs in Bitbucket.
* [RapidDeploy project deploy task](http://docs.midvision.com/LATEST/project/deployment.html) invoke a deployment task in RapidDeploy server. Multiple deployments can be executed sequentially or parallel. You can check the result and the process logs in the Pipelines logs in Bitbucket.
* [RapidDeploy run job plan task](http://portal.midvision.com/page/job-plan-how-to) invoke a job plan from RapidDeploy server. You can check the result and the process logs in the Pipelines logs in Bitbucket.


### Building RapidDeploy package from Bitbucket Pipelines

In order to build RapidDeploy package you need to specify following Bitbucket Environment Variables:
* RapidDeploy server url: provide the server path to your RapidDeploy with the starting http included (e.g.:http://192.168.1.1:8090/MidVision).
* RapidDeploy authentication token: provide your authentication token, which can be generated by the encryptor tool. The tool is placed under the server home directory (MV_HOME for RapidDeploy) in tools: run-web-service-encrypter.
* RapidDeploy project: RapidDeploy project name, which you want to build a package for.
* Package name (optional): set a specific package name. If not filled, the next version will be assigned to the package automatically. This field doesnâ€™t have to be used in general.
* Archive extension: choose the package type from a list of extensions.


![Adding bitbucket environment variables](/AddingBitbucketEnvVariables.png "Adding bitbucket environment variables")


After adding RapidDeploy attributes you need to add your Bitbucket Pipeline configuration. In order to enable Bitbucket Pipelines you need to put bitbucket-pipelines.yml file to your repository (to the top level).  
By adding these four lines below you will integrate your Bitbucket repository with RapidDeploy, so that every time the commit is pushed to the repository - new package will be built on specified RapidDeploy instance for specified RapidDeploy project.

```
- git clone https://github.com/MidVision/bitbucket-rapiddeploy.git
- cd bitbucket-rapiddeploy
- chmod u+x buildRapidDeployPackage.sh
- ./buildRapidDeployPackage.sh
```

So your bitbucket-pipelines.yml file may look like that:

![Pipeline configuration for build task](/pipelineConfForBuildTask.png "Pipeline configuration for RD build task")

If you now push some changes to your repository new package will be automatically created in your RapidDeploy instance

![Successful build package](/successfulBuildPackage.png "Successful build package")

![Successful build package on RapidDeploy](/successfulBuildPackageRD.png "Successful build package on RapidDeploy")



```
- git clone https://github.com/MidVision/bitbucket-rapiddeploy.git
- cd bitbucket-rapiddeploy
- chmod u+x deployRapidDeployProject.sh
- ./deployRapidDeployProject.sh
```



```
- git clone https://github.com/MidVision/bitbucket-rapiddeploy.git
- cd bitbucket-rapiddeploy
- chmod u+x runRapidDeployJobPlan.sh
- ./runRapidDeployJobPlan.sh
```
