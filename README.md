# RapidDeploy integration for Bitbucket Pipelines

### Bitbucket Pipelines

Bitbucket Pipelines is a new continuous delivery feature built within Bitbucket Cloud. RapidDeploy integration with Bitbucket is very simple. It allows you to build package, deploy or run RapidDeploy job directly from Bitbucket. You can configure your Bitbucket Pipeline to perform actions from RapidDeploy automatically every time your code is pushed to the branch.


There are three actions that you can use in your Bitbucket Pipeline
* [RapidDeploy build package task](https://github.com/MidVision/bitbucket-rapiddeploy#building-rapiddeploy-package-from-bitbucket-pipelines) invoke RapidDeploy server to build a package in the configured artifact repository. You can check the result and the log output in the Pipelines logs in Bitbucket.
* [RapidDeploy project deploy task](https://github.com/MidVision/bitbucket-rapiddeploy#deploying-rapiddeploy-project-from-bitbucket-pipelines) invoke a deployment task in RapidDeploy server. Multiple deployments can be executed sequentially or parallel. You can check the result and the process logs in the Pipelines logs in Bitbucket.
* [RapidDeploy run job plan task](https://github.com/MidVision/bitbucket-rapiddeploy#running-rapiddeploy-job-plan-from-bitbucket-pipelines) invoke a job plan from RapidDeploy server. You can check the result and the process logs in the Pipelines logs in Bitbucket.


### Building RapidDeploy package from Bitbucket Pipelines

In order to build RapidDeploy package you need to specify following Bitbucket Environment Variables:
* RapidDeploy server url: provide the server path to your RapidDeploy with the starting http included (e.g.:http://192.168.1.1:8090/MidVision).
* RapidDeploy authentication token: provide your authentication token, which can be generated by the encryptor tool. The tool is placed under the server home directory (MV_HOME for RapidDeploy) in tools: run-web-service-encrypter.
* RapidDeploy project: RapidDeploy project name, which you want to build a package for.
* Package name (optional): set a specific package name. If not filled, the next version will be assigned to the package automatically. This field doesnâ€™t have to be used in general.
* Archive extension: choose the package type from a list of extensions.


![Adding bitbucket environment variables](/resources/AddingBitbucketEnvVariables.png "Adding bitbucket environment variables")


After adding RapidDeploy attributes you need to add your Bitbucket Pipeline configuration. In order to enable Bitbucket Pipelines you need to put bitbucket-pipelines.yml file to your repository (to the top level).  
By adding these four lines below you will integrate your Bitbucket repository with RapidDeploy, so that every time the commit is pushed to the repository - new package will be built on specified RapidDeploy instance for specified RapidDeploy project.

```
- git clone https://github.com/MidVision/bitbucket-rapiddeploy.git
- cd bitbucket-rapiddeploy
- chmod u+x buildRapidDeployPackage.sh
- ./buildRapidDeployPackage.sh
```

So your bitbucket-pipelines.yml file may look like that:

![Pipeline configuration for build task](/resources/pipelineConfForBuildTask.png "Pipeline configuration for RD build task")

If you now push some changes to your repository new package will be automatically created in your RapidDeploy instance

![Successful build package](/resources/successfulBuildPackage.png "Successful build package")

![Successful build package on RapidDeploy](/resources/successfulBuildPackageRD.png "Successful build package on RapidDeploy")


### Deploying RapidDeploy project from Bitbucket Pipelines
In order to build RapidDeploy package you need to specify following Bitbucket Environment Variables:
* RapidDeploy server url: provide the server path to your RapidDeploy with the starting http included (e.g.:http://192.168.1.1:8090/MidVision).
* RapidDeploy authentication token: provide your authentication token, which can be generated by the encryptor tool. The tool is placed under the server home directory (MV_HOME for RapidDeploy) in tools: run-web-service-encrypter.
* RapidDeploy project: RapidDeploy project name, which you want to run the deployment for.
* RapidDeploy server: server name in RapidDeploy which you want to deploy to.
* RapidDeploy environment: environment name in RapidDeploy which you want to deploy to.
* RapidDeploy application: application name which you want to deploy to.
* Deployment package name: provide a deployment package name in RapidDeploy, which you want to deploy. Leave empty, if you want to deploy the latest package.  

![Adding bitbucket environment variables for deploy](/resources/EnvVariablesForDeploy.png "Adding bitbucket environment variables for deploy")

After adding RapidDeploy attributes you need to add your Bitbucket Pipeline configuration. In order to enable Bitbucket Pipelines you need to put bitbucket-pipelines.yml file to your repository (to the top level).  
By adding these four lines below you will integrate your Bitbucket repository with RapidDeploy, so that every time the commit is pushed to the repository - project specified in Environment Variables will be deployed on your RapidDeploy instance.

```
- git clone https://github.com/MidVision/bitbucket-rapiddeploy.git
- cd bitbucket-rapiddeploy
- chmod u+x deployRapidDeployProject.sh
- ./deployRapidDeployProject.sh
```
So your bitbucket-pipelines.yml file may look like that:

![Pipeline configuration for deploy task](/resources/pipelineConfForDeploy.png "Pipeline configuration for RD deploy task")

If you now push some changes to your repository new deploy will be automatically performed in your RapidDeploy instance

![Successful deploy](/resources/successfulDeployment.png "Successful deploy")

![Successful deploy on RapidDeploy](/resources/successfulDeploymentRD.png "Successful deploy on RapidDeploy")

### Running RapidDeploy job plan from Bitbucket Pipelines
In order to build RapidDeploy package you need to specify following Bitbucket Environment Variables:
* RapidDeploy server url: provide the server path to your RapidDeploy with the starting http included (e.g.:http://192.168.1.1:8090/MidVision).
* RapidDeploy authentication token: provide your authentication token, which can be generated by the encryptor tool. The tool is placed under the server home directory (MV_HOME for RapidDeploy) in tools: run-web-service-encrypter.
* RapidDeploy Job Plan ID: Id of a Job Plan from RapidDeploy you would like to start. In RapidDeploy go to Resources -> JobPlans to see the details of all job plans

![Adding bitbucket environment variables for deploy](/resources/EnvVariablesForJobPlan.png "Adding bitbucket environment variables for deploy")

After adding RapidDeploy attributes you need to add your Bitbucket Pipeline configuration. In order to enable Bitbucket Pipelines you need to put bitbucket-pipelines.yml file to your repository (to the top level).  
By adding these four lines below you will integrate your Bitbucket repository with RapidDeploy, so that every time the commit is pushed to the repository - job plan specified in Environment Variables will be performed on your RapidDeploy instance.

```
- git clone https://github.com/MidVision/bitbucket-rapiddeploy.git
- cd bitbucket-rapiddeploy
- chmod u+x runRapidDeployJobPlan.sh
- ./runRapidDeployJobPlan.sh
```

So your bitbucket-pipelines.yml file may look like that:

![Pipeline configuration for job plan task](/resources/pipelineConfForJobPlan.png "Pipeline configuration for RD job plan task")

If you now push some changes to your repository job plan with specified ID will be automatically performed in your RapidDeploy instance

![Successful job plan run](/resources/successfulRunJobPlan.png "Successful job plan run")

![Successful job plan on RapidDeploy](/resources/successfulRunJobPlanRD.png "Successful job plan on RapidDeploy")
